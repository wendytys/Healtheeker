!function(v,a,l,e){"use strict";function o(){this.isMobile=function(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},this.transitionEvent=function(){var t=l.createElement("fakeelement"),i={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var o in i)if(t.style[o]!==e)return i[o];return null},this.animationEvent=function(){var t=l.createElement("fakeelement"),i={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var o in i)if(t.style[o]!==e)return i[o];return null}}var n="imagelinks-instance";function h(t,i){0,this.util=new o,this.$container=null,this.config=null,this.controls={},this.imageWidth=0,this.imageHeight=0,this.markers=[],this.tooltipZindex=[],this.bodyClick=!1,this.themeClass=null,this.timerIdResize=null,this.timerIdScroll=null,this.ready=!1,this._init(t,i)}h.prototype={VERSION:"1.0.0",defaults:{theme:"default",width:null,height:null,imgSrc:null,delayResize:100,markers:[],className:null,onPreInit:null,onLoad:null},defaultsMarker:{x:0,y:0,width:null,height:null,angle:null,imgSrc:null,link:null,linkNewWindow:!1,responsive:!1,noevents:!1,tooltip:null,data:null,dataSelector:null,className:null},defaultsTooltip:{active:!0,placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,trigger:"hover",followCursor:!1,responsive:!1,interactive:!0,smart:!1,showOnInit:!1,showAnimation:null,hideAnimation:null,duration:300,data:null,dataSelector:null,className:null},util:null,_init:function(t,i){this.$container=t,this.config=i,this._create()},_create:function(){var i=this;function o(){i._buildDOM(),i._setTheme(i.config.theme),i._bind(),i._initMarkers(),i._beforeReady(),i._updateSize(),i._ready()}var e=new Image;e.onload=v.proxy(function(t){i.imageWidth=e.width,i.imageHeight=e.height,setTimeout(o,300)},this),e.onerror=v.proxy(function(t){console.error('Cannot load image "'+i.config.imgSrc+'"')},this),e.src=i.config.imgSrc},_setTheme:function(t){this.$container.removeClass(this.themeClass),this.themeClass=t?"imgl-theme-"+t.toLowerCase():null,this.$container.addClass(this.themeClass)},_buildDOM:function(){this.controls.$image=v("<div>").addClass("imgl-image").css({"background-image":"url("+this.config.imgSrc+")"}),this.controls.$stage=v("<div>").addClass("imgl-stage"),this.controls.$markers=v("<div>").addClass("imgl-markers"),this.controls.$tooltips=v("<div>").addClass("imgl-tooltips"),this.controls.$lastMarker=v("<div>").addClass("imgl-marker-last").attr("tabindex",1),this.controls.$stage.append(this.controls.$markers.append(this.controls.$lastMarker),this.controls.$tooltips),this.controls.$image.append(this.controls.$stage),this.$container.prepend(this.controls.$image).addClass("imgl-map").addClass(this.config.className),null!=this.config.width&&this.$container.css({width:this.config.width}),null!=this.config.height&&this.$container.css({height:this.config.height})},_bind:function(){v(a).on("resize",v.proxy(this._onResize,this)),v(a).on("scroll",v.proxy(this._onScroll,this)),v("body").on("click",v.proxy(this._onBodyClickTooltip,this)),this.controls.$lastMarker.on("focus",v.proxy(this._onLastMarkerFocus,this))},_unbind:function(){v(a).off("resize",v.proxy(this._onResize,this)),v(a).off("scroll",v.proxy(this._onScroll,this)),v("body").off("click",v.proxy(this._onBodyClickTooltip,this)),this.controls.$lastMarker.off("focus",v.proxy(this._onLastMarkerFocus,this))},_beforeReady:function(){this.$container.addClass("imgl-before-ready"),this.$container.get(0).offsetHeight,this.$container.is(":hidden")&&this.$container.css("display","block");for(var t=0;t<this.markers.length;t++){var i=this.markers[t];if(!i.cfg.tooltip.widthFromCSS){var o=i.$tooltip.get(0).getBoundingClientRect(),e=i.cfg.tooltip.width?i.cfg.tooltip.width:o.width+1;i.$tooltip.css({width:e})}i.$tooltipPos.css({width:"auto"}),(i.cfg.tooltip.showOnInit||"sticky"==i.cfg.tooltip.trigger)&&this._showTooltip(i)}this.$container.removeClass("imgl-before-ready")},_ready:function(){if(this.config.onLoad){var t=null;if("string"==typeof this.config.onLoad)try{t=new Function(this.config.onLoad)}catch(t){console.error('Can not compile "onLoad" function: '+t.message)}else"function"==typeof this.config.onLoad&&(t=this.config.onLoad);t&&t.call(this)}this.$container.addClass("imgl-ready"),this.ready=!0,this.$container.trigger("imagelinks:ready",[this])},_destroy:function(){this._unbind(),this.controls.$image.remove(),this.$container.removeClass("imgl-ready").removeClass("imgl-map").removeClass(this.config.className),this._setTheme(null),0},_updateSize:function(){var t=this.imageHeight/this.imageWidth,i=this.controls.$image.width(),o=null==this.config.height?t*i:this.$container.height();null==this.config.height&&this.controls.$image.css({height:o});for(var e=i/this.imageWidth,s=o/this.imageHeight,r=0;r<this.markers.length;r++){var a=this.markers[r];a.cfg.responsive&&a.$markerZoom.css({transform:"scale("+e+","+s+")"}),a.cfg.tooltip.responsive&&a.$tooltipZoom.css({transform:"scale("+e+","+s+")"}),a.tooltipVisible&&this._showTooltip(a)}},_updatePlacement:function(){for(var t=0;t<this.markers.length;t++){var i=this.markers[t];i.tooltipVisible&&this._showTooltip(i)}},_initMarkers:function(){if(this.config.markers)for(var t=0;t<this.config.markers.length;t++){var i=this.config.markers[t];this._addMarker(i)}},_addMarker:function(t){t.tooltip=v.extend(!0,{},this.defaultsTooltip,t.tooltip);t=v.extend(!0,{},this.defaultsMarker,t);var i=v("<div>").addClass("imgl-marker-wrap").addClass(t.className),o=v("<div>").addClass("imgl-marker-pos").css({top:t.y+"%",left:t.x+"%"}),e=v("<div>").addClass("imgl-marker-offset"),s=v("<div>").addClass("imgl-marker-zoom"),r=v("<div>").addClass("imgl-marker");if(t.imgSrc&&r.css({"background-image":"url("+t.imgSrc+")"}),t.noevents&&r.addClass("imgl-noevents"),"focus"==t.tooltip.trigger&&r.attr("tabindex",1),t.autoWidth||null==t.width||r.css({width:t.width}),t.autoHeight||null==t.height||r.css({height:t.height}),null!=t.angle&&r.css({transform:"rotate("+t.angle+"deg)"}),t.data)r.html(t.data);else if(t.dataSelector){(m=v(t.dataSelector)).length&&(m.detach(),r.append(m))}else{(m=this.$container.find(".imgl-store > .imgl-pin-"+(this.markers.length+1))).length&&(m.detach(),r.append(m))}i.append(o.append(s.append(e.append(r)))),this.controls.$markers.append(i),this.controls.$lastMarker.detach(),this.controls.$markers.append(this.controls.$lastMarker),t.tooltip=v.extend(!0,{},this.defaultsTooltip,t.tooltip);var a=v("<div>").addClass("imgl-tooltip-wrap").addClass("imgl-hide").addClass(t.tooltip.className),l=v("<div>").addClass("imgl-tooltip-pos").css({top:t.y+"%",left:t.x+"%"}),n=v("<div>").addClass("imgl-tooltip-zoom"),h=v("<div>").addClass("imgl-tooltip-offset"),c=v("<div>").addClass("imgl-tooltip-form"),p=v("<div>").addClass("imgl-tooltip-arrow"),d=v("<div>").addClass("imgl-tooltip-frame"),g=v("<div>").addClass("imgl-tooltip");if((t.tooltip.showAnimation||t.tooltip.hideAnimation)&&t.tooltip.duration&&c.css({"animation-duration":t.tooltip.duration+"ms","-webkit-animation-duration":t.tooltip.duration+"ms"}),t.tooltip.data)g.html(t.tooltip.data);else if(t.tooltip.dataSelector){(m=v(t.tooltip.dataSelector)).length&&(m.detach(),g.append(m))}else{var m;(m=this.$container.find(".imgl-store .imgl-tt-"+(this.markers.length+1))).length&&(m.detach(),g.append(m))}a.append(l.append(n.append(h.append(c.append(d.append(g),p))))),this.controls.$tooltips.append(a);t={$markerWrap:i,$markerPos:o,$markerZoom:s,$markerOffset:e,$marker:r,$tooltipWrap:a,$tooltipPos:l,$tooltipZoom:n,$tooltipOffset:h,$tooltipForm:c,$tooltipFrame:d,$tooltip:g,tooltipVisible:!1,cfg:t};this._bindMarker(t),this.markers.push(t),this._updateBodyClick()},_bindMarker:function(t){switch(t.cfg.link&&t.$marker.on("click",v.proxy(this._onMarkerClickLink,this,t)),t.cfg.tooltip.trigger){case"hover":t.$marker.on("mouseenter",v.proxy(this._onMarkerEnterTooltip,this,t)),t.$marker.on("mouseleave",v.proxy(this._onMarkerLeaveTooltip,this,t)),this.util.isMobile()&&(t.$marker.on("focus",v.proxy(this._onMarkerFocusTooltip,this,t)),t.$marker.on("blur",v.proxy(this._onMarkerBlurTooltip,this,t)));break;case"focus":t.$marker.on("focus",v.proxy(this._onMarkerFocusTooltip,this,t)),t.$marker.on("blur",v.proxy(this._onMarkerBlurTooltip,this,t));break;case"click":case"clickbody":t.$marker.on("click",v.proxy(this._onMarkerClickTooltip,this,t))}},_deleteMarker:function(t){if(0<=t&&t<this.markers.length){var i=this.markers[t];return i.$markerWrap.remove(),i.$tooltipWrap.remove(),this.markers.splice(t,1),!0}return!1},_updateBodyClick:function(){this.bodyClick=!1;for(var t=0;t<this.markers.length;t++){var i=this.markers[t];if("clickbody"==i.cfg.tooltip.trigger||"focus"==i.cfg.tooltip.trigger){this.bodyClick=!0;break}}},_getViewportOffset:function(t){var i=v(a),o=i.scrollLeft(),e=i.scrollTop(),s=t.get(0).getBoundingClientRect(),r=t.offset();return{left:r.left-o,top:r.top-e,bottom:Math.max(l.documentElement.clientHeight,a.innerHeight||0)-r.top+e-s.height,right:Math.max(l.documentElement.clientWidth,a.innerWidth||0)-r.left+o-s.width}},_showTooltip:function(t,i,o,e){if(t.cfg.tooltip.active){var s=this.imageHeight/this.imageWidth,r=this.$container.width(),a=null==this.config.height?s*r:this.$container.height(),l=r/this.imageWidth,n=a/this.imageHeight,h="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:(!t.cfg.autoHeight&&t.cfg.height?t.cfg.height:t.$marker.height())*(t.cfg.responsive&&!t.cfg.tooltip.responsive?n:1)/2,c="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:(!t.cfg.autoWidth&&t.cfg.width?t.cfg.width:t.$marker.width())*(t.cfg.responsive&&!t.cfg.tooltip.responsive?l:1)/2,p=t.cfg.tooltip.offset.y,d=t.cfg.tooltip.offset.x;switch(i=i||!1,o=o||t.cfg.tooltip.placement,e=e||!1,t.$tooltipWrap.removeClass(t.$tooltipWrap.data("placement")),t.$tooltipWrap.addClass("imgl-tooltip-"+o).data("placement","imgl-tooltip-"+o),o){case"top-left":h=-h,c=-c,p=-p,d=d;break;case"top":h=-h,p=-p,d=c=0;break;case"top-right":h=-h,c=c,p=-p,d=-d;break;case"right-top":h=-h,c=c,p=p,d=d;break;case"right":c=c,p=h=0,d=d;break;case"right-bottom":h=h,c=c,p=-p,d=d;break;case"bottom-right":h=h,c=c,p=p,d=-d;break;case"bottom":h=h,p=p,d=c=0;break;case"bottom-left":h=h,c=-c,p=p,d=d;break;case"left-bottom":h=h,c=-c,p=-p,d=-d;break;case"left":c=-c,p=h=0,d=-d;break;case"left-top":h=-h,c=-c,p=p,d=-d;break;default:h=c=t.cfg.tooltip.followCursor?5:0}if(t.$tooltipOffset.css({"margin-top":h,"margin-left":c}),t.cfg.tooltip.followCursor&&"hover"==t.cfg.tooltip.trigger&&(t.$marker.on("mousemove",v.proxy(this._onMarkerMouseMoveTooltip,this,t)),t.$tooltipWrap.addClass("imgl-noevents-hard")),t.$tooltipPos.css({top:t.cfg.y+"%",left:t.cfg.x+"%","margin-top":p,"margin-left":d}),!t.tooltipVisible){t.tooltipVisible=!0,t.$tooltipWrap.addClass("imgl-show").removeClass("imgl-hide");var g=0<this.tooltipZindex.length?Math.max.apply(null,this.tooltipZindex)+1:1;this.tooltipZindex.push(g),t.$tooltipPos.css("z-index",g),i&&t.cfg.tooltip.showAnimation&&(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.showAnimation),t.$tooltipForm.one(this.util.animationEvent(),v.proxy(function(t,i){v(i.target).removeClass(t.cfg.tooltip.showAnimation)},this,t)))}if(!e&&t.cfg.tooltip.smart){var m=this._getViewportOffset(t.$markerOffset),f=this._getViewportOffset(t.$tooltipOffset),u=t.$markerOffset.get(0).getBoundingClientRect(),k=t.$tooltipOffset.get(0).getBoundingClientRect();switch(o){case"top-left":f.right<0&&(o=0<m.left+u.width-k.width?o.replace("-left","-right"):o.replace("-left","")),f.top<0&&(o=o.replace("top","bottom"));break;case"top":f.right<0&&0<m.left+u.width-k.width&&(o+="-right"),f.left<0&&0<m.right+u.width-k.width&&(o+="-left"),f.top<0&&(o=o.replace("top","bottom"));break;case"top-right":f.left<0&&(o=0<m.right+u.width-k.width?o.replace("-right","-left"):o.replace("-right","")),f.top<0&&(o=o.replace("top","bottom"));break;case"right-top":f.top<0&&u.height>k.height&&(o=o.replace("-top","-bottom")),f.right<0&&(o=o.replace("right","left"));break;case"right":f.top<0&&(u.height>k.height?o+="-bottom":o+="-top"),f.bottom<0&&(u.height>k.height?o+="-top":o+="-bottom"),f.right<0&&(o=o.replace("right","left"));break;case"right-bottom":f.bottom<0&&u.height>k.height&&(o=o.replace("-bottom","-top")),f.right<0&&(o=o.replace("right","left"));break;case"bottom-right":f.left<0&&(o=0<m.right+u.width-k.width?o.replace("-right","-left"):o.replace("-right","")),f.bottom<0&&(o=o.replace("bottom","top"));break;case"bottom":f.right<0&&0<m.left+u.width-k.width&&(o+="-right"),f.left<0&&0<m.right+u.width-k.width&&(o+="-left"),f.top<0&&(o=o.replace("bottom","top"));break;case"bottom-left":f.right<0&&(o=0<m.left+u.width-k.width?o.replace("-left","-right"):o.replace("-left","")),f.bottom<0&&(o=o.replace("bottom","top"));break;case"left-bottom":f.bottom<0&&u.height>k.height&&(o=o.replace("-bottom","-top")),f.left<0&&(o=o.replace("left","right"));break;case"left":f.top<0&&(u.height>k.height?o+="-bottom":o+="-top"),f.bottom<0&&(u.height>k.height?o+="-top":o+="-bottom"),f.left<0&&(o=o.replace("left","right"));break;case"left-top":f.top<0&&u.height>k.height&&(o=o.replace("-top","-bottom")),f.left<0&&(o=o.replace("left","right"))}this._showTooltip(t,!1,o,!0,!1)}}},_hideTooltip:function(t){t.$marker.off("mousemove",v.proxy(this._onMarkerMouseMoveTooltip,t,this)),t.$tooltipWrap.removeClass("imgl-noevents-hard"),t.tooltipVisible&&(t.tooltipVisible=!1,t.cfg.tooltip.hideAnimation?(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.one(this.util.animationEvent(),v.proxy(function(t,i){v(i.target).removeClass(t.cfg.tooltip.hideAnimation),t.tooltipVisible||this.__hideTooltip(t)},this,t))):this.__hideTooltip(t))},__hideTooltip:function(t){t.$tooltipWrap.addClass("imgl-hide").removeClass("imgl-show");var i=this.tooltipZindex.indexOf(parseInt(t.$tooltipPos.css("z-index"),10));-1<i&&this.tooltipZindex.splice(i,1),t.$tooltipPos.css("z-index",""),t.$tooltip.detach(),t.$tooltip.get(0).offsetHeight,t.$tooltip.appendTo(t.$tooltipFrame)},_onMarkerClickLink:function(t,i){t.cfg.link&&a.open(t.cfg.link,t.cfg.linkNewWindow?"_blank":"_self")},_onMarkerEnterTooltip:function(t,i){this._showTooltip(t,!0)},_onMarkerLeaveTooltip:function(t,i){var o=i.relatedTarget||i.toElement;t.cfg.tooltip.interactive&&(0!==t.$tooltipWrap.has(o).length||t.$tooltipWrap.is(o))||t.$marker.is(o)?t.$tooltipWrap.one("mouseleave",v.proxy(this._onMarkerLeaveTooltip,this,t)):this._hideTooltip(t)},_onMarkerMouseMoveTooltip:function(t,i){var o=this.controls.$stage.get(0).getBoundingClientRect(),e=(i.clientY-o.y)/o.height*100,s=(i.clientX-o.x)/o.width*100;t.$tooltipPos.css({top:e+"%",left:s+"%"})},_onMarkerFocusTooltip:function(t,i){this._showTooltip(t,!0)},_onMarkerBlurTooltip:function(t,i){this._hideTooltip(t)},_onMarkerClickTooltip:function(t,i){t.tooltipVisible?this._hideTooltip(t):this._showTooltip(t,!0)},_onBodyClickTooltip:function(t){if(this.bodyClick)for(var i=t.target||t.relatedTarget||t.toElement,o=0;o<this.markers.length;o++){var e=this.markers[o];0<e.$markerWrap.has(i).length||e.$markerWrap.is(i)||e.tooltipVisible&&("clickbody"==e.cfg.tooltip.trigger||"focus"==e.cfg.tooltip.trigger&&!e.$marker.is(":focus"))&&(!e.tooltipVisible||e.cfg.tooltip.interactive&&(0!==e.$tooltipWrap.has(i).length||e.$tooltipWrap.is(i))||this._hideTooltip(e))}},_onLastMarkerFocus:function(t){this.markers.length&&this.markers[0].$marker.focus()},_onResize:function(){if(this.ready){var t=this;clearTimeout(this.timerIdResize),this.timerIdResize=setTimeout(function(){t._updateSize()},this.config.delayResize)}},_onScroll:function(){if(this.ready){var t=this;clearTimeout(this.timerIdScroll),this.timerIdScroll=setTimeout(function(){t._updatePlacement()},100)}},setTheme:function(t){this._setTheme(t)},addMarker:function(t){this._addMarker(t)},deleteMarker:function(t){return this._deleteMarker(t)}},v.fn.imagelinks=function(a,t){if("instance"!=a)return this.each(function(){var o=v(this),e=o.data(n),t=o.data("json-src"),s=o.data("img-src"),r=v.isPlainObject(a)?a:t?null:{};if("destroy"==a)return e?(o.removeData(n),void e._destroy()):void console.error('Calling "destroy" method on not initialized instance is forbidden');function i(){var t=v.extend(!0,{},h.prototype.defaults,r);if(null==t.imgSrc&&s&&(t.imgSrc=s),t.onPreInit){var i=null;if("string"==typeof t.onPreInit)try{i=new Function("config",t.onPreInit)}catch(t){console.error('Can not compile "onPreInit" function: '+t.message)}else"function"==typeof t.onPreInit&&(i=t.onPreInit);i&&i.call(this,t)}e=new h(o,t),o.data(n,e)}e&&(o.removeData(n),e._destroy(),e=null),null==r?v.ajax({url:t,type:"GET",dataType:"json"}).done(function(t){r=v.isPlainObject(t)?t:{}}).fail(function(){r={}}).always(function(){i()}):i()});var i=v(this).data(n);return i||void console.error('Calling "instance" method on not initialized instance is forbidden')},v(".imgl-map").imagelinks()}(jQuery,window,document);